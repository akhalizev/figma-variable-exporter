<!DOCTYPE html>
<html>
<head>
  <title>Variable Exporter and Counter</title>
  <style>
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
      padding: 0;
      margin: 0;
      color: #333;
      background: #ffffff;
    }
    
    .container {
      padding: 0;
    }
    h1 {
      font-size: 18px;
      margin-bottom: 15px;
    }
    h2 {
      font-size: 16px;
      margin-top: 15px;
      margin-bottom: 10px;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }
    button { 
      padding: 8px 16px; 
      margin-top: 15px;
      background: #18A0FB;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    button:hover {
      background: #0D8CE0;
    }
    .meta {
      font-size: 12px;
      color: #666;
      margin-bottom: 15px;
    }
    .format-options {
      margin-top: 15px;
      padding: 10px;
      border: 1px solid #eee;
      border-radius: 4px;
      background: #f9f9f9;
    }
    select {
      padding: 5px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .type-count {
      color: #999;
      font-size: 12px;
      margin-left: 5px;
    }
    
    /* Export section styles */
    .export-section {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #e1e5e9;
        border-radius: 6px;
        background: #f8f9fa;
    }
    
    .export-section h3 {
        margin: 0 0 10px 0;
        font-size: 14px;
        font-weight: 600;
        color: #1e1e1e;
    }
    
    .export-options {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 10px;
    }
    
    .checkbox-group {
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .input-group {
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .input-group input[type="text"], .input-group input[type="number"] {
        flex: 1;
        padding: 4px 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 12px;
    }
    
    .export-buttons {
        display: flex;
        gap: 8px;
    }
    
    .export-buttons button {
        flex: 1;
    }
    
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="padding: 20px;">
      <h1>Variable Exporter</h1>
      <div class="meta">
        <div>File: <span id="file-name">Loading...</span></div>
        <div>Total variables: <span id="count">0</span></div>
      </div>

      <div class="export-section">
        <h3>JSON Export</h3>
        <div class="export-options">
          <div class="checkbox-group">
            <input type="checkbox" id="organized-format" checked>
            <label for="organized-format">Organized format (group by type)</label>
          </div>
          <div class="input-group">
            <label for="json-indent">Indentation:</label>
            <input type="number" id="json-indent" value="2" min="0" max="8">
          </div>
        </div>
        <button id="export-json">Export JSON</button>
      </div>

      <div class="export-section">
        <h3>CSS Export</h3>
        <div class="export-options">
          <div class="checkbox-group">
            <input type="checkbox" id="css-use-prefix">
            <label for="css-use-prefix">Use variable prefix</label>
          </div>
          <div class="input-group">
            <label for="css-prefix">Prefix:</label>
            <input type="text" id="css-prefix" value="figma-" placeholder="e.g., figma-">
          </div>
          <div class="checkbox-group">
            <input type="checkbox" id="css-group-collections" checked>
            <label for="css-group-collections">Group by type</label>
          </div>
          <div class="checkbox-group">
            <input type="checkbox" id="css-remove-duplicates" checked>
            <label for="css-remove-duplicates">Remove duplicate words (e.g., accordion-accordion â†’ accordion)</label>
          </div>
        </div>
        <button id="export-css">Export CSS</button>
      </div>

      <div class="export-section">
        <h3>Style Guide</h3>
        <p>Create a visual style guide frame in your Figma file.</p>
        <button id="create-style-guide">Create Style Guide</button>
      </div>
    </div>
  </div>
    <div class="export-options">
      <div class="checkbox-group">
        <input type="checkbox" id="include-comments" checked>
        <label for="include-comments">Include Comments</label>
      </div>
      <div class="input-group">
        <label for="file-name-input">File Name:</label>
        <input type="text" id="file-name-input" placeholder="Enter file name">
      </div>
    </div>
    
    <div class="export-buttons">
      <button id="export">Export Variables</button>
      <button id="create-style-guide" style="background-color: #4CAF50;">Create Style Guide Frame</button>
    </div>
  </div>

  <script>
    // State variables
    let exportData = null;
    
    // Event listeners for export buttons
    document.getElementById('export-json').addEventListener('click', () => {
      const organized = document.getElementById('organized-format').checked;
      const indent = parseInt(document.getElementById('json-indent').value);
      
      parent.postMessage({
        pluginMessage: {
          type: 'export-json',
          organized: organized,
          indent: indent
        }
      }, '*');
    });

    document.getElementById('export-css').addEventListener('click', () => {
      const usePrefix = document.getElementById('css-use-prefix').checked;
      const prefix = document.getElementById('css-prefix').value;
      const groupByCollection = document.getElementById('css-group-collections').checked;
      const removeDuplicateWords = document.getElementById('css-remove-duplicates').checked;
      
      parent.postMessage({
        pluginMessage: {
          type: 'export-css',
          options: {
            usePrefix: usePrefix,
            prefix: prefix,
            groupByCollection: groupByCollection,
            removeDuplicateWords: removeDuplicateWords
          }
        }
      }, '*');
    });

    document.getElementById('create-style-guide').addEventListener('click', () => {
      parent.postMessage({
        pluginMessage: { 
          type: 'create-style-guide',
          data: exportData
        }
      }, '*');
    });
    
    // Function to render preview
    // Handle messages from plugin
    window.addEventListener('message', (event) => {
      const msg = event.data.pluginMessage;
      
      if (msg.type === 'variables-data') {
        exportData = msg.data;
      } else if (msg.count !== undefined) {
        exportData = msg.exportData;
        document.getElementById('count').textContent = msg.count;
        document.getElementById('file-name').textContent = msg.exportData.metadata.fileName;
      } else if (msg.type === 'download-file') {
        // Handle file downloads
        const blob = new Blob([msg.content], { type: msg.mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = msg.filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    });
    
    // Request initial data
    parent.postMessage({
      pluginMessage: { type: 'get-variables' }
    }, '*');
  </script>
</body>
</html>